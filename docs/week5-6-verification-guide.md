# 第5-6周内容管理系统验证指南

## 📋 验证概述

本指南用于验证博客平台第5-6周（内容管理系统）开发的功能完整性和质量标准。

### 验证范围

- 文章管理系统（CRUD操作）
- Markdown编辑器系统
- 文件上传系统
- 分类管理系统
- 标签管理系统
- 搜索功能

### 开发成果

第5-6周完成了完整的内容管理系统，包括文章创建、编辑、管理、展示和搜索等核心功能。

## 🚀 环境准备

### 1. 环境要求检查

```bash
# 检查 Node.js 版本 (需要 >= 18.0.0)
node --version

# 检查 pnpm 版本 (需要 >= 8.0.0)
pnpm --version

# 检查 Docker 环境
docker --version
docker-compose --version
```

### 2. 项目启动

```bash
# 安装依赖
pnpm install

# 启动开发环境
docker-compose -f docker-compose.dev.yml up -d

# 检查服务状态
docker-compose -f docker-compose.dev.yml ps

# 推送数据库架构
pnpm run db:push

# 生成 Prisma 客户端
pnpm run db:generate

# 启动开发服务器
pnpm run dev
```

**预期结果**:

- 所有服务正常运行
- 开发服务器在 http://localhost:3000 启动
- 数据库连接成功
- 可以正常访问首页

### 3. 测试数据准备

```bash
# 创建管理员用户 (运行设置脚本)
node scripts/set-admin.mjs

# 验证管理员用户创建成功
echo "管理员用户已创建，请使用创建的凭据登录测试"
```

## 📝 文章管理系统验证

### 4. 文章创建功能验证

#### 4.1 访问文章创建页面

1. 登录系统
2. 访问 http://localhost:3000/posts/create

**预期结果**:

- 页面正常加载
- 显示文章创建表单
- 包含标题、内容、摘要、分类、标签等字段
- 显示Markdown编辑器

#### 4.2 测试文章创建API

```bash
# 获取认证令牌后测试创建文章
curl -X POST http://localhost:3000/api/posts \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "title": "测试文章标题",
    "content": "# 这是一篇测试文章\n\n文章内容使用Markdown格式编写。",
    "excerpt": "这是文章摘要",
    "status": "published",
    "categoryId": "1",
    "tags": ["测试", "开发"]
  }'
```

**预期结果**:

```json
{
  "success": true,
  "data": {
    "id": "1",
    "title": "测试文章标题",
    "slug": "ce-shi-wen-zhang-biao-ti",
    "content": "# 这是一篇测试文章\n\n文章内容使用Markdown格式编写。",
    "excerpt": "这是文章摘要",
    "status": "published",
    "readingTime": 1,
    "wordCount": 15,
    "createdAt": "2024-12-XX...",
    "author": {...},
    "category": {...},
    "tags": [...]
  }
}
```

#### 4.3 文章表单验证测试

1. 尝试提交空标题
2. 尝试提交过长标题（>100字符）
3. 尝试提交空内容
4. 验证必填字段提示

**预期结果**:

- 显示相应的验证错误提示
- 阻止无效数据提交
- 错误信息清晰明确

### 5. 文章编辑功能验证

#### 5.1 文章编辑页面访问

1. 访问文章详情页
2. 点击"编辑"按钮（需要是文章作者或管理员）

**预期结果**:

- 重定向到编辑页面
- 表单自动填充现有文章数据
- 权限验证正确

#### 5.2 测试文章编辑API

```bash
# 更新文章
curl -X PUT http://localhost:3000/api/posts/1 \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "title": "更新后的文章标题",
    "content": "# 更新的文章内容\n\n这是更新后的内容。",
    "status": "published"
  }'
```

**预期结果**:

- 文章更新成功
- 返回更新后的文章数据
- updatedAt 字段被更新

#### 5.3 权限控制测试

1. 尝试以非作者身份编辑文章
2. 验证管理员可以编辑所有文章

**预期结果**:

- 非作者无法编辑他人文章
- 管理员可以编辑任何文章
- 正确的权限错误提示

### 6. 文章删除功能验证

#### 6.1 软删除功能测试

```bash
# 删除文章 (软删除)
curl -X DELETE http://localhost:3000/api/posts/1 \
  -H "Authorization: Bearer YOUR_TOKEN"
```

**预期结果**:

```json
{
  "success": true,
  "message": "文章已删除"
}
```

#### 6.2 验证软删除效果

1. 文章在前台不再显示
2. 文章在数据库中仍存在但设置了 `deletedAt` 字段
3. 相关统计数据已更新

### 7. 文章列表管理验证

#### 7.1 我的文章页面

1. 访问 http://localhost:3000/dashboard/posts
2. 验证显示当前用户的所有文章

**预期结果**:

- 显示文章列表（包括草稿和已发布）
- 支持状态筛选
- 显示文章统计信息
- 提供快速操作按钮

#### 7.2 文章状态管理

1. 测试草稿保存
2. 测试发布操作
3. 测试归档操作

**预期结果**:

- 状态切换正常
- 界面实时更新
- 数据持久化正确

## ✏️ Markdown编辑器系统验证

### 8. 编辑器基础功能验证

#### 8.1 Markdown语法支持

在编辑器中输入以下内容：

````markdown
# 一级标题

## 二级标题

### 三级标题

**粗体文本**
_斜体文本_
~~删除线~~

- 列表项1
- 列表项2
  - 嵌套列表

1. 有序列表
2. 第二项

`内联代码`

```javascript
// 代码块
function hello() {
  console.log('Hello World!');
}
```
````

> 引用文本

[链接](https://example.com)

| 表格   | 头部 |
| ------ | ---- |
| 单元格 | 数据 |

````

**预期结果**:
- 实时预览正确渲染所有Markdown语法
- 代码高亮正常显示
- 表格格式正确
- 链接可正常访问

#### 8.2 编辑器工具栏功能
测试工具栏的所有按钮：
1. 粗体按钮
2. 斜体按钮
3. 标题按钮
4. 链接按钮
5. 图片按钮
6. 代码按钮
7. 全屏模式

**预期结果**:
- 所有工具栏按钮正常工作
- 光标位置正确插入语法
- 全屏模式正常切换

#### 8.3 编辑器增强功能
1. 测试快捷键支持（Ctrl+B, Ctrl+I等）
2. 测试预览同步滚动
3. 测试拖拽图片上传

**预期结果**:
- 快捷键响应正确
- 预览与编辑区同步滚动
- 拖拽上传正常工作

## 📁 文件上传系统验证

### 9. 图片上传功能验证

#### 9.1 上传界面测试
1. 在编辑器中点击图片上传按钮
2. 测试点击上传和拖拽上传

**预期结果**:
- 上传界面正常显示
- 支持点击选择文件
- 支持拖拽上传

#### 9.2 文件类型验证
尝试上传不同格式的文件：
- 支持的格式：JPEG, PNG, GIF, WebP
- 不支持的格式：PDF, TXT, DOC等

**预期结果**:
- 支持的图片格式成功上传
- 不支持的格式显示错误提示

#### 9.3 文件大小限制测试
1. 上传小于5MB的图片
2. 尝试上传大于5MB的图片

**预期结果**:
- 小文件正常上传
- 大文件显示大小限制错误

#### 9.4 上传API测试
```bash
# 测试图片上传API
curl -X POST http://localhost:3000/api/upload \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -F "file=@test-image.jpg"
````

**预期结果**:

```json
{
  "success": true,
  "data": {
    "url": "https://xxx.blob.vercel-storage.com/xxx.jpg",
    "filename": "test-image.jpg",
    "size": 123456
  }
}
```

### 10. 文件管理功能验证

#### 10.1 自动插入编辑器

1. 上传图片成功后
2. 验证Markdown代码自动插入编辑器

**预期结果**:

- 自动在光标位置插入 `![alt](url)` 格式
- 图片在预览中正常显示

#### 10.2 上传进度显示

1. 上传较大图片时观察进度条
2. 验证上传状态提示

**预期结果**:

- 显示上传进度百分比
- 上传完成后显示成功提示

## 🏷️ 分类管理系统验证

### 11. 分类CRUD功能验证

#### 11.1 分类列表获取

```bash
# 获取所有分类
curl http://localhost:3000/api/categories
```

**预期结果**:

```json
{
  "success": true,
  "data": [
    {
      "id": "1",
      "name": "技术",
      "slug": "tech",
      "description": "技术相关文章",
      "postCount": 5
    }
  ]
}
```

#### 11.2 分类创建（管理员）

```bash
# 创建新分类
curl -X POST http://localhost:3000/api/categories \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer ADMIN_TOKEN" \
  -d '{
    "name": "生活随笔",
    "description": "记录生活点滴"
  }'
```

**预期结果**:

- 管理员可以成功创建分类
- 自动生成slug
- 返回创建的分类数据

#### 11.3 分类权限验证

1. 普通用户尝试创建分类
2. 普通用户尝试删除分类

**预期结果**:

- 普通用户操作被拒绝
- 返回权限错误提示

### 12. 分类页面验证

#### 12.1 分类列表页面

访问 http://localhost:3000/categories

**预期结果**:

- 显示所有分类
- 显示每个分类的文章数量
- 分类卡片布局美观

#### 12.2 分类文章页面

访问 http://localhost:3000/categories/tech

**预期结果**:

- 显示该分类下的所有文章
- 文章按发布时间排序
- 支持分页功能

## 🔍 搜索功能验证

### 13. 搜索API测试

#### 13.1 基础搜索功能

```bash
# 搜索文章
curl "http://localhost:3000/api/search?q=测试&type=posts"
```

**预期结果**:

```json
{
  "success": true,
  "data": {
    "posts": [
      {
        "id": "1",
        "title": "测试文章",
        "excerpt": "...",
        "author": {...},
        "category": {...}
      }
    ],
    "total": 1,
    "hasMore": false
  }
}
```

#### 13.2 高级搜索功能

```bash
# 按分类搜索
curl "http://localhost:3000/api/search?q=JavaScript&category=tech"

# 按作者搜索
curl "http://localhost:3000/api/search?author=testuser"
```

**预期结果**:

- 支持多条件组合搜索
- 搜索结果准确
- 性能表现良好

### 14. 搜索界面验证

#### 14.1 搜索框功能

1. 在导航栏搜索框输入关键词
2. 测试实时搜索建议
3. 测试搜索结果页面

**预期结果**:

- 实时显示搜索建议
- 搜索结果页面布局正确
- 支持搜索历史

#### 14.2 搜索结果展示

1. 验证搜索结果高亮
2. 验证分页功能
3. 验证排序功能

**预期结果**:

- 关键词高亮显示
- 分页正常工作
- 支持按相关性和时间排序

## 🏷️ 标签系统验证

### 15. 标签功能测试

#### 15.1 标签获取API

```bash
# 获取所有标签
curl http://localhost:3000/api/tags
```

**预期结果**:

- 返回标签列表
- 包含使用次数统计
- 按使用频率排序

#### 15.2 标签自动创建

1. 在文章中输入新标签
2. 发布文章

**预期结果**:

- 新标签自动创建
- 标签与文章正确关联
- 标签计数正确更新

#### 15.3 标签搜索功能

1. 按标签筛选文章
2. 测试标签页面

**预期结果**:

- 标签筛选正确
- 标签页面显示相关文章

## 📊 性能和安全验证

### 16. 性能测试

#### 16.1 页面加载性能

使用浏览器开发者工具测试：

1. 首页加载时间
2. 文章详情页加载时间
3. 编辑器初始化时间

**预期标准**:

- 首页加载 < 2秒
- 文章详情页 < 1.5秒
- 编辑器初始化 < 1秒

#### 16.2 API响应性能

```bash
# 测试API响应时间
time curl http://localhost:3000/api/posts
```

**预期标准**:

- API响应时间 < 500ms
- 数据库查询优化
- 无明显性能瓶颈

### 17. 安全验证

#### 17.1 输入验证测试

1. 测试XSS攻击防护
2. 测试SQL注入防护
3. 测试CSRF防护

**预期结果**:

- 恶意输入被过滤
- 数据库查询安全
- CSRF令牌验证正确

#### 17.2 文件上传安全

1. 尝试上传恶意文件
2. 验证文件类型检查
3. 测试文件大小限制

**预期结果**:

- 恶意文件被拒绝
- 文件类型严格验证
- 大小限制正确执行

## ✅ 验证完成检查清单

### 核心功能验证

- [ ] 文章创建功能正常
- [ ] 文章编辑功能正常
- [ ] 文章删除功能正常（软删除）
- [ ] 文章列表管理正常
- [ ] Markdown编辑器功能完整
- [ ] 文件上传功能正常
- [ ] 分类管理功能正常
- [ ] 标签系统功能正常
- [ ] 搜索功能正常

### 用户体验验证

- [ ] 界面响应速度良好
- [ ] 移动端适配正确
- [ ] 错误提示清晰明确
- [ ] 操作反馈及时
- [ ] 导航流程顺畅

### 安全性验证

- [ ] 权限控制正确
- [ ] 输入验证有效
- [ ] 文件上传安全
- [ ] 数据传输加密
- [ ] 错误信息不泄露敏感数据

### 性能验证

- [ ] 页面加载速度符合标准
- [ ] API响应时间符合标准
- [ ] 数据库查询优化
- [ ] 图片加载优化
- [ ] 缓存策略有效

## 🔧 问题排查指南

### 常见问题及解决方案

#### 数据库连接问题

```bash
# 检查数据库服务状态
docker-compose -f docker-compose.dev.yml ps

# 重启数据库服务
docker-compose -f docker-compose.dev.yml restart mysql

# 检查数据库连接
pnpm run db:studio
```

#### 文件上传问题

1. 检查 Vercel Blob 配置
2. 验证环境变量设置
3. 检查文件权限

#### 编辑器问题

1. 清除浏览器缓存
2. 检查JavaScript控制台错误
3. 验证组件依赖

#### 搜索功能问题

1. 检查数据库索引
2. 验证搜索API参数
3. 检查搜索结果格式

---

**注意**:

- 所有API测试需要替换 `YOUR_TOKEN` 为实际的认证令牌
- 请确保测试环境数据不会影响生产环境
- 建议使用自动化测试工具进行回归测试
- 验证过程中发现的问题请及时记录并修复
